<body>
<pre>
<div id="timercontent" style="display: none"></div>
<div class="timershrink2" id="timerliquefy">Flux</div>

<div class="timershrink" id="timerstomp">X</div>
<div class="timershrink" id="timershrink">Z</div>
<div class="timershrink powershrink" id="powerfreeze">Freeze</div>

<p id="speedsys" class="speedsys">1| Speed:</p>
<p id="leveldetect" class="leveldetect">Level: 1</p>
<p id="energy" class="energy">2| Energy:</p>
<p id="regen" class="regen">3| Regen:</p>
<p id="exp" class="exp">Points: 0</p>

</pre>

<div id="evader">
  <div id="whpreview"></div>
  <div id="powerup1"></div>
  <div id="attractor"></div>
</div>


  
  <div id="affected">
    <div class="sys" id="sys">
      <button class="runner" id="runner"></button>
    </div>
    <div class="hidden" id="hidden">
      <p class="custom" id="custom">&gt;_</p>

      <code class="hiddenp" id="hiddenp">&gt;?
<p class="non" id="no">
&gt;&gt;&gt; coins for this session: </p>
<p class="non" id="no1">
&gt;&gt;&gt; high score:
</p>
<p class="non" id="no2">
&gt;&gt;&gt; level: 
</p>
<button class="non" id="no3"><a href="shop.html">
&gt;&gt;&gt; shop 
</button></a>
<div style="padding: 10px"></div>
<button class="non" id="no4" onclick="window.location.reload()">
&gt;&gt;&gt; skip
</button>
</code>
    </div>
</body>
<p class="textother"></p>

</div>
<style>
#timerstomp {
  display: none;
  left: 2.25em;
}
#attractor {
  position: absolute;
  opacity: 0;
  padding: 225;
  border-radius: 100%;
  background-color: black;
}
#powerup1 {
  opacity: 0;
  padding: 350px;
  border-radius: 100%;
  background-color: blue;

}
#whpreview {
  position: absolute;
  
  opacity: 0;
  padding: 200px;
  border-radius: 100%;
  background-color: blue;

}

#timercontent {
  position: absolute;
  background-color: black;
  opacity: .7;
  color: white;
  font-family: arial;
  font-size: 15px;
  border-radius: 15%;
  padding: 15px;
  right: 10px;
  top: 10px;
  
}
#timerliquefy {
  position: absolute;
  display: none;
  background-color: cyan;

  
  right: 5px;
  bottom: 5px;



}
.flarhom {
  position: absolute;
  top: 50%;
  left: 50%;
  border-radius: 100%;
  padding: 15px;
  background-color: #080100;
}
@keyframes implode {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(0); opacity: 0.5; }
}

@keyframes flyOut {
  0% { transform: scale(0.4); opacity: 1; }
  100% { transform: scale(0.9); opacity: 0; }
}

.imploding {
  animation: implode 0.25s ease-in forwards;
}

.boomShard {
  position: absolute;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background-color: cyan;
  animation: flyOut 0.3s ease-out forwards;
}
  .energy {
    position: absolute;
    top: 50px;
    left: 10px;
  }

  .regen {
    position: absolute;
    top: 65px;
    left: 10px;
  }
  .exp {
    position: absolute;
    top: 80px;
    left: 10px;
  }

  .leveldetect {
    position: absolute;
    top: 20px;
    left: 10px;
  }

  @keyframes cpulse {
    0% {
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
    }

    70% {
      box-shadow: 0 0 0 30px rgba(255, 255, 255, 0);
    }

    100% {
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
    }
  }
.cpulse2 {
  animation: cpulse 1s ease-in-out 10;
}
.cpulse3 {
  animation: cpulse 0.4s ease-in-out 1;
}
  @keyframes sheepulse {
    0% {
      box-shadow: 0 0 0 10px rgba(245, 73, 39, 0.7);
      transform: rotate(0deg);

    }


    70% {
      box-shadow: 0 0 0 50px rgba(245, 73, 39, 0.5);
      transform: rotate(380deg);
    }

    100% {
      box-shadow: 0 0 0 30px rgba(168, 76, 57, 0.2);
      transform: rotate(0deg);
    }
  }
  .sheepu {
    animation: sheepulse .5s ease-in-out;
  }
  

  @keyframes screenshake {

    0%,
    100% {
      transform: translate3d(0, 0, 0);
      /* Start and end at original position */
    }

    20%,
    60% {
      transform: translate3d(-5px, 0, 0);
      /* Move left */
    }

    40%,
    80% {
      transform: translate3d(5px, 0, 0);
      /* Move right */
    }

    /* Optional: Add vertical or rotational movement for more complex shake */
    30% {
      transform: translate3d(0, -3px, 0) rotate(1deg);
      /* Move up slightly and rotate */

    }

    70% {
      transform: translate3d(0, 3px, 0) rotate(-1deg);
      /* Move down slightly and rotate */
    }
  }

  @keyframes sepulse {
    0% {
      box-shadow: 0 0 10px 30px #701705;
      border-radius: 100px;
      opacity: .3;

    }

    10% {
      opacity: .4;

    }

    15% {
      opacity: .5;
    }

    20% {
      opacity: .6;
    }

    25% {
      opacity: .7;
    }

    30% {
      opacity: .8;
    }

    70% {
      box-shadow: 0 10px 0 5000px rgba(255, 255, 255, 0.4);
      border-radius: 100px;

    }

    100% {
      box-shadow: 0 0 0 25px #701705;
      border-radius: 100px;

    }
  }

  @keyframes onecycle {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }

  .timershrink {
    color: white;
    width: 20px;
    height: 20px;
    background-color: green;
    position: absolute;

    top: 10px;
    border-color: black;
    border-radius: 25%;
    border-style: solid;
    border-width: 0px;
    font-family: Arial, Sans-Serif;

    /*  animation: timeout 1s linear 5;*/
  }
  .timershrink2 {
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
    color: black;
    padding: 5px;

    background-color: cyan;
    position: absolute;
    border-color: black;
    border-radius: 25%;
    border-style: solid;
    border-width: 0px;
    font-family: Arial;
  }

  #timershrink {
    left: .50em;
  }


  #evader {
    width: 45px;
    height: 45px;
    background-color: dodgerblue;
    position: absolute;
    top: 50%;
    left: 50%;

    border-radius: 300px;
    text-align: center;
    display: flex;
    /* Make the div a flex container */
    justify-content: center;
    /* Horizontally center its content */
    align-items: center;
    /* Vertically center its content */
    border-radius: 100px;
  }







  .non {
    display: none;
  }

  @keyframes textother {
    0% {
      opacity: 1;
    }

    100% {
      opacity: 0;
    }
  }

  @keyframes opacity {
    0% {
      opacity: 1;
    }

    10% {
      opacity: 0.6;
    }

    25% {
      opacity: 0.8;
    }

    35% {
      opacity: 0.6;
    }

    50% {
      opacity: 0.8;
    }

    60% {
      opacity: 0.6;
    }

    75% {
      opacity: 0.8;
    }

    85% {
      opacity: 0.6;
    }

    100% {
      opacity: 1;
    }
  }

  .custom {
    display: none;
    text-align: left;
    font-size: 23px;
    color: #27F5AD;
  }

  .hidden {
    display: none;
    background-color: #08290A;
    border-radius: 25px;
    border-color: #27F5AD;
    border-width: 1px;
    border-style: solid;
    padding: 20px;
    animation: opacity 5s linear alternate infinite;
  }

  .hiddenp {
    display: none;
    text-align: left;
    display: none;
    font-size: 15px;
    color: #27F5AD;
    ;
    animation: opacity 5s linear alternate infinite;
    padding: 20px;
    background-color: black;
    border-radius: 5px;
  }

  @keyframes rotatiger {
    0% {
      transform: rotate(0deg);
    }

    360% {
      transform: rotate(360deg);
    }
  }

  body {
    background-color: #7486B8;

    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .screenshake {
    animation: screenshake .5s linear infinite;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    perspective: 1000px;
  }

  .runner {

    display: none;
    box-shadow: 0 0 40px 10px #280C97;
    border-color: #425BEB;
    border-width: 23px;
    border-radius: 1000px;
    background-image: linear-gradient(45deg, #27F5E0, #27F5A9, #375E5A);
    clip-path: polygon(50% 0%, 93.3% 25%, 93.3% 75%, 50% 100%, 6.7% 75%, 6.7% 25%);
    padding: 40px;

  }

  .sys {
    display: none;
    filter: drop-shadow(0px 0px 10px #2C05F7);
    position: absolute;
    border-color: #425BEB;
    border-width: 20px;
    border-radius: 1000px;

    padding: 140px;

    opacity: 1;
  }

  @keyframes rotating {
    0% {
      transform: rotate(0deg);
    }

    30% {
      transform: rotate(90deg);
    }

    70% {
      transform: rotate(100deg);
    }

    85% {
      transform: rotate(180deg);
    }

    99% {
      transform: rotate(380deg);
    }

    100% {
      transform: rotate(3721deg);
    }
  }

  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
    }

    70% {
      box-shadow: 0 0 0 30px #173054;
    }

    100% {
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
    }
  }

  .sys:hover {
    animation: pulse 0.3s ease-in-out infinite;
  }

  .flarnum {
 
    position: absolute;
    width: 20px;
    height: 20px;
    background-color: #3A6F91;
    border-radius: 200px;
  }

  .flare {
    visibility: visible;
    display: block;
    background-color: blue;

    animation-name: pulse, rotating;
    animation-duration: 0.3s;

    padding: 13px;
    border-radius: 100px;
    border-color: #09EDB4;
    border-width: 7;
  }

  .gunner {
    position: absolute;
    visibility: visible;
    display: block;
    background-color: blue;
    border-width: 5px;
    background-image: linear-gradient(45deg, #375E5A #27F5A9, #375E5A);
    padding: 10px;
    border-radius: 20px;

  }

  @keyframes timeout {
    0% {
      border-width: 4px;
      border-color: black;
    }

    100% {
      border-width: 4px;
      border-color: black;
    }
  }

  #speedsys {
    left: 10px;
    top: 35px;
    position: absolute;
  }
  .boomer {
    border-radius: 100%;
    border-style: solid;
    border-width: 0px;
  }
#powerfreeze {
  width: 60px;
  padding: 2.2px;
  left: 10px;
  top: 96.5%;
  bottom: 10px;

}
</style>

<script>
  
const textdepth = document.getElementById("timercontent")
const textdeput = document.querySelectorAll(".timershrink, .timershrink2")

textdeput.forEach(x => {
  x.addEventListener("mouseout", () => {
    textdepth.textContent = " "
    textdepth.style.display = 'none'
  })
  x.addEventListener("mouseover", () => {
    textdepth.style.display = "block"
  })
})
document.getElementById("timerstomp").addEventListener("mouseover", () => {
  textdepth.textContent = `Stomp
  
  Home to the nearest enemy
  and kill the enemy for 5s
  all while gaining .5s of 
  invincibility
  Cooldown = 4 seconds
  Costs 5 energy`
})
document.getElementById("timerliquefy").addEventListener("mouseover", () => {
  
  textdepth.textContent = `Flux
  
  Turn yourself into a state
  of liquid matter making yourself 
  invincible for 3 seconds but becoming
  2x bigger and every enemy you hit 
  becomes 1.5x faster for 10s
  (Also activates on contact of an enemy)
  Cooldown = 10 seconds
  Costs 15 energy`
})
document.getElementById("powerfreeze").addEventListener("mouseover", () => {
  if (document.getElementById("powerfreeze").textContent === "Freeze") {
  textdepth.textContent = `Freeze
  
  Make mobile balls stop
  moving for 3 seconds
  within a 550px radius
  Cooldown = 10s`
  } else if (document.getElementById("powerfreeze").textContent = "Icicle Rockets") {
    textdepth.textContent = `Icicle Rockets
    
    Spawns 4 high-speed missiles
  that target the nearest vulnerable
  enemy but explodes in .5 seconds 
  Cooldown = 10s`
  }
})

document.getElementById('timershrink').addEventListener('mouseover', () => {
  textdepth.textContent = `Breathing in
  
  Shrinks down 50% for 5s 
  Cooldown = 5 seconds
  Costs 15 energy`;
});

let points = 1;
let pointT = 0;
//let highScoreList = []
function leveldetere() {
  document.getElementById('no2').textContent = ">>> level: " + points
  requestAnimationFrame(leveldetere)
}
requestAnimationFrame(leveldetere)
    function collision(a, b) {
      return (
        a.left < b.right &&
        a.right > b.left &&
        a.top < b.bottom &&
        a.bottom > b.top)
    }
    function collision1(a, b) {
      collision(a, b);
    }
  function nextInitialize() {
    

    let cliquefy = document.getElementById("timerliquefy")
    let regen = document.getElementById("regen")
    let energy = document.getElementById("energy")
    let gun;
    let increaseRate = 1;
    let currentEnergy = 30;
    let maximumE = 30;
    let defualtspeed = 7;
    let speed = 0;
    let homer;
    const guns = []
    let speedg = 7
    let speed2 = 4;
    let xthrow = false;
    let invi1 = false;
    let xonclick = false;
    let xactivity = false;
    let pointDisplay = 0
    let checkiftrue = true
    let speedFactor = 5
    let speedsub = 0
    const exp = document.getElementById("exp")
    const powerup1 = document.getElementById("powerup1")
    let powerupCoa = false;
    let powerupCoal = 0;
    let powerup1cd = true;
    const uFlux = localStorage.getItem("?Flux");
    const uIR = localStorage.getItem("?IR")
    let abilStomp = false;
    let gunhyp;
    let uirExecution = true;
    let stompCd = true

    
    



    function reload() {
      exp.textContent = `Points: ${pointT}`
      rect = evader.getBoundingClientRect();

      if (rect.right > window.innerWidth || rect.bottom > window.innerHeight || rect.left < 0 || rect.top < 0) {
        outter = true;
      }
      requestAnimationFrame(reload);
    }
    requestAnimationFrame(reload);
    let speex;
    function reco() {
      speex = defualtspeed / 2
      requestAnimationFrame(reco)
    }
    reco()
    function uIRinit() {
                const one = document.createElement("div")
          const two = document.createElement("div")
          const three = document.createElement("div")
          const four = document.createElement("div")

          one.classList.add("flarnum")
          two.classList.add("flarnum")
          three.classList.add("flarnum")
          four.classList.add("flarnum")

          document.body.appendChild(one)
          document.body.appendChild(two)
          document.body.appendChild(three)
          document.body.appendChild(four)

          const centerX = rect.left + (rect.width / 2) - 10;
          const centerY = rect.top + (rect.height / 2) - 10;
          const spawnDistance = 50;

          one.style.left = `${centerX - spawnDistance}px`;
          one.style.top = `${centerY}px`;

          two.style.left = `${centerX + spawnDistance}px`;
          two.style.top = `${centerY}px`;

          three.style.left = `${centerX}px`;
          three.style.top = `${centerY - spawnDistance}px`;

          four.style.left = `${centerX}px`;
          four.style.top = `${centerY + spawnDistance}px`;
          currentEnergy -= 20;
          spawned = true;
          setTimeout(() => {
            spawned = false;
          }, 7000)

          flarnums.push(one, two, three, four);
          setTimeout(() => {
            one.classList.remove("flarnum")
            two.classList.remove("flarnum")
            three.classList.remove("flarnum")
            four.classList.remove("flarnum")
            document.body.removeChild(one)
            document.body.removeChild(two)
            document.body.removeChild(three)
            document.body.removeChild(four)
          }, 500)
    }

    

    function regenfunct() {

      let increaseToScale = increaseRate / 100
      if (maximumE > currentEnergy) {
        setTimeout(() => {
          currentEnergy = (currentEnergy + increaseToScale);
        }, 100)
      } else if (maximumE < currentEnergy) {
        currentEnergy = maximumE;
      }

      regen.textContent = `3| Regen: ${increaseRate.toFixed(1)}`
      let unFloat = Math.trunc(currentEnergy)
      energy.textContent = `2| Energy: ${unFloat}/${maximumE}`;
      requestAnimationFrame(regenfunct)
    } requestAnimationFrame(regenfunct)
    regenfunct()
    let initOne = false
    let initTwo = false
    let initThree = false
function countDown2(enabled, cooldown, indicator, letter) {
  let i1 = enabled;
  let i2 = cooldown;

  function runEnabledCountdown() {
    indicator.textContent = i1;
    indicator.style.backgroundColor = "blue";
    indicator.style.borderWidth = "2px";

    if (i1 > 0) {

      i1--;
      setTimeout(runEnabledCountdown, 1000);
    } else {
      runCooldownCountdown();
    }
  }


  function runCooldownCountdown() {
    indicator.style.borderWidth = "0px";
    indicator.classList.add("cpulse2");
    indicator.textContent = i2;

    if (i2 > 0) {
      i2--;
      setTimeout(runCooldownCountdown, 1000);
    } else {

      indicator.classList.remove("cpulse2");
      if (indicator === document.getElementById("timerliquefy")) {
      indicator.style.backgroundColor = "cyan";
      } else {
        indicator.style.backgroundColor = "green"
      }
      indicator.textContent = letter;
    }
  }
  runEnabledCountdown();
}
    let gasR = false;
    const cshrink = document.getElementById("timershrink");

    let keyxcall = false;
       function keyx() {
      if (!keyxcall && currentEnergy >= 15) {
        xactivity = true;
        setTimeout(() => {
          xactivity = false;
        }, 3000)
      
      keyxcall = true;
      if (xonclick) {
      evader.style.backgroundColor = "red"
      setTimeout(() => {
        evader.style.backgroundColor = "dodgerblue"
        xonclick = false
      }, 100)}
      
      currentEnergy-= 15
      countDown2(3, 10, cliquefy, 'Flux')
      setTimeout(() => {
        keyxcall = false;
      }, 13000)
      const offsessionw = evader.offsetWidth * 2
      const offsessionh = evader.offsetHeight * 2
      evader.style.width = offsessionw + "px"
      evader.style.height = offsessionh + "px"
      cliquefy.style.borderWidth = "2px"
      cliquefy.style.backgroundColor = "blue"

      finalclickdown = function () {};
      setTimeout(() => {
        cliquefy.style.backgroundColor = "cyan"
        cliquefy.style.borderWidth = "0px"
        finalclickdown = function () {finalclickdownr2()}
        xthrow = false
        evader.style.height = (offsessionh / 2) + "px"
        evader.style.width = (offsessionw / 2) + "px"
        gasR = false;
        evader.style.backgroundColor = "dodgerblue"
          
      }, 3000)
    }
    }
    document.body.addEventListener("keydown", (event) => {

      if (event.key === "x" && stompCd && currentEnergy >= 5 && localStorage.getItem("?Stomp") === "true") {
        stomp()
        countDown2(0, 5, document.getElementById("timerstomp"), "X")
        currentEnergy -= 5;
        stompCd = false
        setTimeout(() => {
          stompCd = true;
        }, 5000)
      }
      
      
      if (event.key === "a" && powerup1cd && uIR === null) {

        powerupCoal++;
        
        if (powerupCoal === 1) {
          powerup1.style.opacity = 0.1
        } else if (powerupCoal === 2) {
          countDown2(0, 10, document.getElementById("powerfreeze"), 'Freeze')
          powerup1cd = false;
          setTimeout(() => {
            powerup1cd = true;
          }, 10000)
          powerup1.style.opacity = 0;
          powerupCoa = true;
          setTimeout(() => {
            powerupCoa = false;
          }, 5)
          powerupCoal = 0;
        }

      } else if (event.key === "a" && uIR === "true" && powerup1cd) {
        uIRinit()
        powerup1cd = false;
        setTimeout(() => {
          powerup1cd = true;
        }, 10000)
        countDown2(0, 10, document.getElementById("powerfreeze"), 'Icicle Rockets')
      }


      if (event.key === "2" && !initTwo && pointT >= 1) {
        maximumE = maximumE + 5;
        pointT--;
        initTwo = true;
        setTimeout(() => {
          initTwo = false;
        }, 100)
      }
      if (event.key === "1" && !initOne && pointT >= 1) {
        
        defualtspeed += 0.5

        pointT--;
        initOne = true;
        setTimeout(() => {
          initOne = false;
        }, 100)
      }
      if (event.key === "3" && !initThree && pointT >= 1) {
        
        pointT--;
        increaseRate += Math.round(.2 * 10) / 10;

        initThree = true;
        setTimeout(() => {
          initThree = false;
        }, 100)
      }
    })
    let lD = document.getElementById('leveldetect');
    let token;

 

    const speedsys = document.getElementById("speedsys")
    function countdown() {
      cshrink.textContent = "5"
      setTimeout(() => {
        cshrink.textContent = "4"
      }, 1000);
      setTimeout(() => {
        cshrink.textContent = "3"
      }, 2000);
      setTimeout(() => {
        cshrink.textContent = "2"
      }, 3000);
      setTimeout(() => {
        cshrink.textContent = "1"
      }, 4000);
      setTimeout(() => {
        cshrink.textContent = "5"
      }, 5000);
      setTimeout(() => {
        cshrink.textContent = "4"
      }, 6000);
      setTimeout(() => {
        cshrink.textContent = "3"
      }, 7000);
      setTimeout(() => {
        cshrink.textContent = "2"
      }, 8000);
      setTimeout(() => {
        cshrink.textContent = "1"
      }, 9000);
    }


    const evader = document.getElementById('evader');
    let outter = false;
    let rect;
    let token1;
    let rectG;



 const flarnums = []; 
const flarnumSize = 20; 
const flarnumSpeed = 20; 
function updateNearestGun() {
  gunhyp = [];
  guns.forEach((em) => {
    const emrect = em.getBoundingClientRect();
    const distance = Math.hypot(
      (emrect.left + emrect.width / 2) - (rect.left + rect.width / 2),
      (emrect.top + emrect.height / 2) - (rect.top + rect.height / 2)
      );
    gunhyp.push({ em, distance});
  });
  gunhyp.sort((a, b) => a.distance - b.distance);
}
function stomp() {
  

    updateNearestGun()

    let cg2 = gunhyp[0].em
    let closestgun = (gunhyp[0].em).getBoundingClientRect();
    const targetLeft = closestgun.left + (closestgun.width / 2) - (rect.width / 2);
    const targetTop = closestgun.top + (closestgun.height / 2) - (rect.height / 2);


    const currentLeft = parseFloat(evader.style.left) || rect.left;
    const currentTop = parseFloat(evader.style.top) || rect.top;

    const dx = targetLeft - currentLeft;
    const dy = targetTop - currentTop;
    const dist = Math.hypot(dx, dy) || 1;
    const stepX = (dx / dist) * 20;
    const stepY = (dy / dist) * 20;

    evader.style.left = (currentLeft + stepX) + 'px';
    evader.style.top = (currentTop + stepY) + 'px';


  if (!collision(rect, closestgun)) {
    requestAnimationFrame(stomp)
    evader.style.backgroundColor = "#4799a1"
    finalclickdown = function () { };
    abilStomp = true
  } else {
    evader.style.backgroundColor = "#122526"
    cg2.style.opacity = ".25"
    setTimeout(() => {
      cg2.style.opacity = "1"
    }, 5000)
    evader.classList.add("cpulse3")
    setTimeout(() => {
      evader.classList.remove("cpulse3")
      finalclickdown = function () {finalclickdownr2()};
      evader.style.backgroundColor = "dodgerblue"
      abilStomp = false;
    }, 500)
  }
} 





function level30() {
  
  if (points >= 30) {//ENABLE IT BY SETTING 300 TO 30


    updateNearestGun()
    
    
    let closestgun = (gunhyp[0].em).getBoundingClientRect();
    const targetLeft = closestgun.left + (closestgun.width / 2) - (rect.width / 2);
    const targetTop = closestgun.top + (closestgun.height / 2) - (rect.height / 2);


    const currentLeft = parseFloat(evader.style.left) || rect.left;
    const currentTop = parseFloat(evader.style.top) || rect.top;

    const dx = targetLeft - currentLeft;
    const dy = targetTop - currentTop;
    const dist = Math.hypot(dx, dy) || 1;
    const stepX = (dx / dist) * 2;
    const stepY = (dy / dist) * 2;
    if (collision(closestgun, document.getElementById("attractor").getBoundingClientRect())) {
      evader.style.left = (currentLeft + stepX) + 'px';
      evader.style.top = (currentTop + stepY) + 'px';
    }

  } 

  requestAnimationFrame(level30)
}
requestAnimationFrame(level30)

function updateFlarnums() {
  for (let i = 0; i < flarnums.length; i++) {
    const el = flarnums[i];
    const currentLeft = parseFloat(el.style.left) || el.getBoundingClientRect().left;
    const currentTop = parseFloat(el.style.top) || el.getBoundingClientRect().top;

    gunhyp = [];
    guns.forEach((em) => {
      const emrect = em.getBoundingClientRect();
      const distance = Math.hypot(
        (emrect.left + emrect.width / 2 - flarnumSize / 2) - currentLeft,
        (emrect.top + emrect.height / 2 - flarnumSize / 2) - currentTop
      );
      gunhyp.push({ em, distance });

      document.querySelectorAll(".flarnum").forEach(florrr => {
        const florer = florrr.getBoundingClientRect();
        if (collision(emrect, florer)) {
          em.style.display = "none"
          const rotateInterval = Math.random() * (360 - (-360)) + (-360);
          const boomer = document.createElement("div")
          boomer.classList.add("boomer", "imploding")
          boomer.style.backgroundColor = "red"
          boomer.style.position = "absolute"
          boomer.style.width = "1px"
          boomer.style.height = "1px"
          boomer.style.left = `${florer.left}px`
          boomer.style.top = `${florer.top}px`
          boomer.style.transform = `rotate(${rotateInterval}deg)`

          document.body.appendChild(boomer)
          setTimeout(() => {
  const centerX = florer.left + 12; 
  const centerY = florer.top + 12;
  
  for (let i = 0; i < 6; i++) {
    const angle = (Math.PI * 1 / 3) * i;
    const shard = document.createElement("div");
    shard.classList.add("boomShard");

    shard.style.left = `${centerX}px`;
    shard.style.top = `${centerY}px`;

    document.body.appendChild(shard);

    const distance = 80;
    const dx = Math.cos(angle) * distance;
    const dy = Math.sin(angle) * distance;


    shard.animate([
      { transform: "translate(0, 0) scale(0.4)", opacity: 1 },
      { transform: `translate(${dx}px, ${dy}px) scale(0.9)`, opacity: 0 }
    ], {
      duration: 500,
      easing: "ease-out",
      fill: "forwards"
    });

    setTimeout(() => {
      document.body.removeChild(shard);
    }, 550);
  }

  // remove the main boomer
  document.body.removeChild(boomer);
}, 150);
          
          
        }
      });
      
    });

    gunhyp.sort((a, b) => a.distance - b.distance);
    let closestgun = (gunhyp[0].em).getBoundingClientRect(); 


    const targetLeft = closestgun.left + (closestgun.width / 2) - (flarnumSize / 2);
    const targetTop = closestgun.top + (closestgun.height / 2) - (flarnumSize / 2);

    const dx = targetLeft - currentLeft;
    const dy = targetTop - currentTop;
    const dist = Math.hypot(dx, dy) || 1;
    const stepX = (dx / dist) * flarnumSpeed;
    const stepY = (dy / dist) * flarnumSpeed;

    el.style.left = (currentLeft + stepX) + 'px';
    el.style.top = (currentTop + stepY) + 'px';
    
  }
  
  requestAnimationFrame(updateFlarnums);
}
requestAnimationFrame(updateFlarnums);
    let shrink = false;
    let spawned = false;
    document.addEventListener('DOMContentLoaded', () => {
      const keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false,
        Shift: false,
        z: false
      };
      if (keys) {
        speed = 0;
      }

      document.addEventListener('keydown', (e) => {
        if (keys.hasOwnProperty(e.key)) {
          keys[e.key] = true;
        }

        if (e.key === "Shift") {
          evader.style.backgroundColor = "#27D6F5"
        }
        if (e.key === "z" && shrink === false && currentEnergy >= 15) {
          countdown();
          cshrink.style.display = "block"
          evader.style.width = "20px";
          evader.style.height = "20px";
          shrink = true;
          cshrink.style.borderWidth = "2px"
          cshrink.style.borderColor = "black"
          cshrink.style.backgroundColor = "blue"
          currentEnergy -= 15;
          setTimeout(() => {

            cshrink.style.borderWidth = "0px"
            evader.style.width = "45px";
            evader.style.height = "45px";
            //
            cshrink.animate([
              { boxShadow: "0 0 0 0 rgba(255, 255, 255, 0.4)" },
              { boxShadow: "0 0 0 30px rgba(255, 255, 255, 0)" },
              { boxShadow: "0 0 0 0 rgba(255, 255, 255, 0)" }
            ], {
              duration: 1000,
              easing: 'ease-in-out',
              iterations: '5',
            });
            //
            setTimeout(() => {
              cshrink.style.background = "green"
              cshrink.style.borderWidth = "0px"
              cshrink.textContent = "Z"
              shrink = false;
            }, 5000);

          }, 5000);

        }
      });

      document.addEventListener('keyup', (e) => {
        if (keys.hasOwnProperty(e.key)) {
          keys[e.key] = false;
        }
        if (e.key === 'Shift') {
          evader.style.backgroundColor = "dodgerblue"
        }
      });

      let step2 = false;
      function alleyoop() {
        let evaderX = evader.offsetLeft;
        let evaderY = evader.offsetTop;

        // Calculate potential new positions
        let newX = evaderX;
        let newY = evaderY;

        // Determine the new speed
        if (keys.Shift && (keys.ArrowUp || keys.ArrowDown || keys.ArrowLeft || keys.ArrowRight)) {
          speed = speex;
        } else if (!keys.ArrowUp && !keys.ArrowDown && !keys.ArrowLeft && !keys.ArrowRight) {
          speed = 0;
        } else {
          speed = defualtspeed;

        }

        // Update position based on key presses and check boundaries
        if (keys.ArrowUp) {
          newY = evaderY - speed;
          if (newY >= 0) {
            evaderY = newY;
          }
        }
        if (keys.ArrowDown) {
          newY = evaderY + speed;
          const maxBottom = window.innerHeight - evader.offsetHeight;
          if (newY <= maxBottom) {
            evaderY = newY;
          }
        }
        if (keys.ArrowLeft) {
          newX = evaderX - speed;
          if (newX >= 0) {
            evaderX = newX;
          }
        }
        if (keys.ArrowRight) {
          newX = evaderX + speed;
          const maxRight = window.innerWidth - evader.offsetWidth;
          if (newX <= maxRight) {
            evaderX = newX;
          }
        }

        // Apply the final positions to the element
        evader.style.left = `${evaderX}px`;
        evader.style.top = `${evaderY}px`;

        // (Optional) Call your spawnact function
        if (keys.ArrowUp || keys.ArrowDown || keys.ArrowLeft || keys.ArrowRight) {

          flare(event)
        }
        
        

        speedsys.textContent = `1| Speed = ${speed}`;

        requestAnimationFrame(alleyoop);
      }
      alleyoop();
    });
    function finalclickdown() {
      //setTimeout(() => {
       finalclickdownr2() 
      //}, 1000)
      
    }
    function finalclickdownr2() {
      if (!abilStomp) {
      if (xthrow) {
        xonclick = true;
        keyx()
      } else {
         finalclickdownr()
      }
      }
    } 
      
      
    
     function finalclickdownr() {
      //localstorage.setItem("levels", )
      localStorage.setItem("run", false)
      
      cliquefy.style.display = 'none'
      energy.style.display = "none"
      regen.style.display = "none"
      lD.style.display = "none"
      token.style.display = "none"
      document.getElementById("powerfreeze").style.display = "none"
      document.getElementById("timerstomp").style.display = "none"
      document.getElementById("exp").style.display = "none"

      document.getElementById("affected").classList.remove('screenshake')
      document.body.addEventListener('keydown', () => {
        event.stopImmediatePropagation();
      });

      // Use querySelectorAll and forEach to properly hide all elements with the class

      document.querySelectorAll(".gunner").forEach(el => {
        el.style.display = "none";
      });


      evader.style.display = "none"
      timershrink.style.display = "none"
      speedsys.style.display = "none"
      
      document.body.style.backgroundColor = "#0A3D22";
      document.getElementById("runner").style.display = "none";
      document.getElementById("sys").style.display = "none";
      document.getElementById("hiddenp").style.display = "block";
      document.getElementById("hidden").style.display = "block";
      document.getElementById("custom").style.display = "block";

      setTimeout(() => {
        let noX = (points - 1) * 5
        let nextrun = true;
        localStorage.setItem("nextrun", nextrun)
        localStorage.setItem("Coins", noX);
        document.getElementById("no").textContent = ">>> coins for this session: " + noX;
        document.getElementById("no").style.display = "block";
      }, 500);
      setTimeout(() => {
        let highScoreList = JSON.parse(localStorage.getItem("highest")) || [];
        highScoreList.push(points)
        const jsonhsl = JSON.stringify(highScoreList)
        localStorage.setItem("highest", jsonhsl);
        const hslStored = localStorage.getItem("highest");
        highScoreList = JSON.parse(hslStored);
        highScoreList.sort((a, b) => b - a);
        document.getElementById("no1").textContent = ">>> high score: " + highScoreList[0]
        document.getElementById("no1").style.display = "block";
      }, 1000);
      setTimeout(() => {
        document.getElementById("no2").style.display = "block";
      }, 1500);
      setTimeout(() => {
        document.getElementById("no3").style.display = "block";
      }, 2000);
      setTimeout(() => {
        document.getElementById("no4").style.display = "block";
      }, 2500);


    }
    function moverBariable() {

      const rotateInterval = Math.random() * (360 - (-360)) + (-360);
      const sys = document.getElementById("sys")
      const heightControl = window.innerHeight;
      const widthControl = window.innerWidth;
      const elemHite = sys.offsetHeight;
      const elemWith = sys.offsetWidth;

      const yCoord = heightControl - elemHite
      const xCoord = widthControl - elemWith

      const width = Math.random() * xCoord;
      const height = Math.random() * yCoord;

      sys.style.transition = "transform 0.3s ease-in-out, top 0.3s ease-in-out, left 0.3s ease-in-out"

      sys.style.top = height + "px";
      sys.style.left = width + "px";
      sys.style.transform = "rotate(" + rotateInterval + "deg)";

    }
    function hexes() {
      const rawHexInt = Math.floor(Math.random() * 16777215);
      let hexColor = rawHexInt.toString(16);
      hexColor = hexColor.padStart(6, '0');
      return '#' + hexColor;
    }
    const sys = document.getElementById("sys");
    const body = document.body;
    let isOnCooldown = false;
    let mouseX = 0;
    let mouseY = 0;
    document.body.addEventListener("mousemove", () => {
      mouseX = event.clientX;
      mouseY = event.clientY;
    });

  

function moveGunner(gunner, angle, speed1) {

  let dx = Math.cos(angle) * speed1;
  let dy = Math.sin(angle) * speed1;
  let fluxBoosted = false;
  

  

  

  function updatePosition() {
    let initialdx = Math.cos(angle) * speed1;
    const initialdy = Math.sin(angle) * speed1;
    
    const rectx = gunner.getBoundingClientRect();
    if (collision(rectx, whpreview.getBoundingClientRect()) && points >= 20) {
      const forceMultiplier = 0.005 * ((speed1) / 0.25);
      const spinDirection = Math.random() > 0.5 ? 1 : -1; 
      dx += dy * forceMultiplier * spinDirection;
      dy -= dx * forceMultiplier * spinDirection;

      
    } 

    if (xactivity) {

     if (collision(rectx, rect) && !fluxBoosted) {
       dx *= 1.5
       dy *= 1.5
       gunner.style.backgroundColor = "#2a344a"
       fluxBoosted = true;
       setTimeout(() => {
         dx = Math.cos(angle) * speed1;
         dy = Math.sin(angle) * speed1;
         gunner.style.backgroundColor = "blue"
         
       }, 10000)
     }
    } 
    if (powerupCoa) {
      if (collision(powerup1.getBoundingClientRect(), rectx)) {
       
        dx = Math.cos(angle) * (speed1 * 0);
        dy = Math.sin(angle) * (speed1 * 0);
        gunner.style.backgroundColor = "#5DCBDE"
        setTimeout(() => {
          dx = Math.cos(angle) * speed1;
          dy = Math.sin(angle) * speed1;
          gunner.style.backgroundColor = "blue"
         
        }, 3000)
        
      }

    }


    let newX = rectx.left + dx;
    let newY = rectx.top + dy;

    
    if (newX <= 0 || newX + rectx.width >= window.innerWidth) {
      dx *= -1; //dis allows to BOUNSE
      newX = Math.max(0, Math.min(newX, window.innerWidth - rectx.width));
    }

   
    if (newY <= 0 || newY + rectx.height >= window.innerHeight) {
      dy *= -1;
      newY = Math.max(0, Math.min(newY, window.innerHeight - rectx.height));
    }

    // Apply the new position
    gunner.style.left = `${newX}px`;
    gunner.style.top = `${newY}px`;

     if (collision(rect, rectx)) {
       if (gunner && parseFloat(getComputedStyle(gunner).opacity) === 0.25) {
       
       
       } else {
        finalclickdown();
       }
     } 
    


    requestAnimationFrame(updatePosition);
  }

  requestAnimationFrame(updatePosition);
}

function flare(event) {
  if (isOnCooldown) {
    return;
  }

  isOnCooldown = true;
  

  const myFlare = document.createElement('button');
  myFlare.className = 'flare';
  myFlare.style.position = 'absolute';
  myFlare.style.left = rect.left + 'px';
  myFlare.style.top = rect.top + 'px';

  const rotateInterval2 = Math.random() * (360 - (-360)) + (-360);
  myFlare.style.transform = "rotate(" + rotateInterval2 + "deg)";

  document.body.appendChild(myFlare);


  // Store the flare's final position before it disappears
  const flarePosition = {
    left: myFlare.style.left,
    top: myFlare.style.top
  };

  // The timeout to hide the flare
  setTimeout(() => {
    const gunnerTermination = Math.random() * (14500 - 11250) + 11250

    document.body.removeChild(myFlare)

    const gunner = document.createElement("div");
    gunner.classList.add("gunner", "enemy");
    guns.push(gunner);
    document.body.appendChild(gunner);
    setTimeout(() => {
      document.body.removeChild(gunner)
    }, gunnerTermination)


    gunner.style.left = flarePosition.left;
    gunner.style.top = flarePosition.top;


    const randomAngle = Math.random() * Math.PI * 2;
    
    if (points % 5 === 0 && checkiftrue) {
      spawnact()
      speedFactor += (1.5 - speedsub)//change for nerfs n stuff
      
      if (speedsub !== 1) {
        speedsub += 0.1
        
      }
      //checkiftrue = false;
      if (points % 5 !== 0) {
        checkiftrue = true;
      }
    }
    moveGunner(gunner, randomAngle, speedFactor); 
    
  }, 300);

  setTimeout(() => {
    isOnCooldown = false;
  }, 1000);
}


    function spawnact() {
      const newColor = hexes();
      body.style.backgroundColor = newColor;
      document.body.style.transition = "background-color 0.15s ease-in";
      
      moverBariable();
    };

    let tokenspawnx;
    let tokenspawny;
    let tokenX = (window.innerWidth) - 40
    let tokenY = (window.innerHeight) - 40

    function getscreenrandom() {

      tokenspawny = Math.random() * tokenY;
      tokenspawnx = Math.random() * tokenX;
      requestAnimationFrame(getscreenrandom)

    }

    getscreenrandom()

    let execution = false;
    function tokenizer() {

      token = document.createElement('div')

      token.style.position = "absolute"
      token.style.width = "40px"
      token.style.height = "40px"
      token.style.top = tokenspawny + "px";
      token.style.left = tokenspawnx + "px";
      token.style.backgroundColor = "yellow"
      token.style.borderRadius = "100px"
      document.body.appendChild(token)
      function reloadtoken() {
        let safeZone;
        function tuffnucke() {
        if (collision(safeZone.getBoundingClientRect(), rect)) {
          finalclickdown = function () { };
          

        } else {
          finalclickdown = function () {finalclickdownr2()};
          safeZone.remove();
        }
        requestAnimationFrame(tuffnucke)
        } requestAnimationFrame(tuffnucke)
        token1 = token.getBoundingClientRect();
        if (collision(rect, token1)) {
          points++;
          pointT++;

            safeZone = document.createElement("div")
            safeZone.style.position = "absolute"
            safeZone.style.top = token1.top + "px"
            safeZone.style.left = token1.left + "px"
            safeZone.style.borderRadius = "100%"
            safeZone.style.height = "40px"
            safeZone.style.width = "40px"
            safeZone.style.backgroundColor = "black"
            document.body.appendChild(safeZone)

        

          if (points === 10) {
            unafk()
          }
          //if ()

          requestAnimationFrame(getscreenrandom)
          token.style.left = tokenspawnx + "px"
          token.style.top = tokenspawny + "px"
          lD.textContent = "Level: " + points

          document.getElementById("affected").classList.add('screenshake')

        } requestAnimationFrame(reloadtoken)
      } requestAnimationFrame(reloadtoken)
    }
    tokenizer()
    
    function unafk() {
    
      homer = document.createElement("div")
      homer.classList.add("flarhom", "enemy")
      document.body.appendChild(homer)
      function scannex() {
        homerx = homer.getBoundingClientRect();
        if (collision(rect, homerx)) {
         finalclickdown();
        }
        requestAnimationFrame(scannex)
      } requestAnimationFrame(scannex)

      flarhom.push(homer);
    }
    
    const flarhom = [];
    const flarhomSize = 20;
    let flarhomSpeed = speed2;
    let homerSensor = 1




    function updateHomer() {
      const targetLeftx = rect.left + (rect.width / 2) - (flarhomSize / 2);
      const targetTopx = rect.top + (rect.height / 2) - (flarhomSize / 2);


      for (let i = 0; i < flarhom.length; i++) {
        const el = flarhom[i];
        const currentLeftx = parseFloat(el.style.left) || el.getBoundingClientRect().left;
        const currentTopx = parseFloat(el.style.top) || el.getBoundingClientRect().top;

        const dxx = targetLeftx - currentLeftx;
        const dyx = targetTopx - currentTopx;
        const dist = Math.hypot(dxx, dyx) || 1;
        let stepXx;
        let stepYy
        if (xactivity && collision(rect, homer.getBoundingClientRect())) {
          homerSensor = 2
          setTimeout(() => {
            homerSensor = 1;
          }, 10000)
        }
        if (powerupCoa && collision(homer.getBoundingClientRect(), powerup1.getBoundingClientRect())) {
          homerSensor = 3;

          setTimeout(() => {
            homerSensor = 1;
          }, 3000)
        }

        if (homerSensor === 1) {
          stepYy = (dyx / dist) * flarhomSpeed;
          stepXx = (dxx / dist) * flarhomSpeed;
          homer.style.backgroundColor = ""
        }
        if (homerSensor === 2) {
          stepXx = (dxx / dist) * flarhomSpeed * 2;
          stepYy = (dyx / dist) * flarhomSpeed * 2;
          
          homer.style.backgroundColor = "#2a344a"
        }
        if (homerSensor === 3) {
          stepXx = (dxx / dist) * flarhomSpeed * 0;
          stepYy = (dyx / dist) * flarhomSpeed * 0;
          homer.style.backgroundColor = "#5DCBDE"
        }
        
        el.style.left = (currentLeftx + stepXx) + 'px';
        el.style.top = (currentTopx + stepYy) + 'px';
      }

      requestAnimationFrame(updateHomer);
    }
    requestAnimationFrame(updateHomer)
    function eventListeners() {
      if (!execution && uFlux === "true") {
            
        document.getElementById("timerliquefy").style.display = 'block'
        xthrow = true;
        execution = true;
     
      }
      if (localStorage.getItem("?Stomp") === "true") {
        document.getElementById("timerstomp").style.display = "block"
      }
      if (uIR === "true" && uirExecution) {
        document.getElementById("powerfreeze").textContent = "Icicle Rockets"
        document.getElementById("powerfreeze").style.width = "110px"
        uIR = false
      }
      requestAnimationFrame(eventListeners)
    }
    requestAnimationFrame(eventListeners)


    
  }//nextINitializeBracket
  nextInitialize()


</script>
